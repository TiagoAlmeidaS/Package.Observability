# Diagramas de Arquitetura de Observabilidade

## ğŸ—ï¸ Arquitetura Atual (HÃ­brida)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AplicaÃ§Ã£o .NET                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Logs        â”‚  â”‚    MÃ©tricas     â”‚  â”‚     Traces      â”‚ â”‚
â”‚  â”‚   (Serilog)     â”‚  â”‚  (Prometheus)   â”‚  â”‚  (OpenTelemetry)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                    â”‚
             â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Loki        â”‚  â”‚   Prometheus    â”‚  â”‚ OTLP Collector  â”‚
â”‚  (AgregaÃ§Ã£o)    â”‚  â”‚   (Scraping)    â”‚  â”‚   (Roteamento)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚     Tempo       â”‚
                                          â”‚  (Armazenamento)â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Arquitetura OTLP Pura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AplicaÃ§Ã£o .NET                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Logs        â”‚  â”‚    MÃ©tricas     â”‚  â”‚     Traces      â”‚ â”‚
â”‚  â”‚ (OpenTelemetry) â”‚  â”‚ (OpenTelemetry) â”‚  â”‚ (OpenTelemetry) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    OTLP Collector       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                    â”‚  â”‚   Processamento â”‚   â”‚
                    â”‚  â”‚   (Filtros,     â”‚   â”‚
                    â”‚  â”‚    Transform.)  â”‚   â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         â”‚               â”‚
                    â–¼         â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Loki    â”‚ â”‚Prometheus â”‚ â”‚   Tempo   â”‚
            â”‚(Logs)     â”‚ â”‚(MÃ©tricas) â”‚ â”‚(Traces)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Arquitetura Recomendada (FlexÃ­vel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AplicaÃ§Ã£o .NET                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Logs        â”‚  â”‚    MÃ©tricas     â”‚  â”‚     Traces      â”‚ â”‚
â”‚  â”‚   (Serilog)     â”‚  â”‚  (Prometheus)   â”‚  â”‚  (OpenTelemetry)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚                    â”‚
             â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Console     â”‚    â”‚   Prometheus  â”‚    â”‚ OTLP Collector â”‚
    â”‚   + Loki      â”‚    â”‚   (Direto)    â”‚    â”‚   (Sempre)    â”‚
    â”‚   (Desenv.)   â”‚    â”‚               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                        â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚     Tempo     â”‚
                                              â”‚ (ProduÃ§Ã£o)    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ConfiguraÃ§Ã£o por Ambiente

### **Desenvolvimento Local**

```
AplicaÃ§Ã£o .NET
â”œâ”€â”€ Logs â†’ Console + Loki (direto)
â”œâ”€â”€ MÃ©tricas â†’ Prometheus (direto)
â””â”€â”€ Traces â†’ OTLP Collector â†’ Tempo
```

**ConfiguraÃ§Ã£o:**
```csharp
options.EnableConsoleLogging = true;
options.LokiUrl = "http://localhost:3100";
options.EnableMetrics = true;
options.OtlpEndpoint = "http://localhost:4317";
```

### **ProduÃ§Ã£o**

```
AplicaÃ§Ã£o .NET
â””â”€â”€ Tudo â†’ OTLP Collector â†’ {Loki, Prometheus, Tempo}
```

**ConfiguraÃ§Ã£o:**
```csharp
options.EnableConsoleLogging = false;
options.LokiUrl = "";
options.EnableMetrics = false;
options.OtlpEndpoint = "http://otel-collector:4317";
```

## ğŸ“Š Fluxo de Dados Detalhado

### **1. Logs (Serilog + Loki)**

```
AplicaÃ§Ã£o .NET
    â†“ (ILogger)
Serilog
    â†“ (WriteTo.GrafanaLoki)
Loki
    â†“ (Query)
Grafana
```

### **2. MÃ©tricas (Prometheus)**

```
AplicaÃ§Ã£o .NET
    â†“ (Meter/Counter/Histogram)
OpenTelemetry Metrics
    â†“ (AddPrometheusExporter)
Prometheus Endpoint (/metrics)
    â†“ (Scraping)
Prometheus Server
    â†“ (Query)
Grafana
```

### **3. Traces (OpenTelemetry + Tempo)**

```
AplicaÃ§Ã£o .NET
    â†“ (ActivitySource)
OpenTelemetry Tracing
    â†“ (AddOtlpExporter)
OTLP Collector
    â†“ (otlp/tempo exporter)
Tempo
    â†“ (Query)
Grafana
```

## ğŸš€ Vantagens de Cada Abordagem

### **ConfiguraÃ§Ã£o Direta**

```
âœ… Simplicidade
âœ… Performance
âœ… Controle total
âœ… Debugging fÃ¡cil
âŒ MÃºltiplos pontos de configuraÃ§Ã£o
âŒ Menos flexibilidade
```

### **OTLP Pura**

```
âœ… PadrÃ£o da indÃºstria
âœ… CentralizaÃ§Ã£o
âœ… Flexibilidade mÃ¡xima
âœ… Processamento centralizado
âŒ Complexidade
âŒ DependÃªncia do Collector
```

### **HÃ­brida (Recomendada)**

```
âœ… Flexibilidade mÃ¡xima
âœ… Performance otimizada
âœ… Compatibilidade
âœ… MigraÃ§Ã£o gradual
âŒ ConfiguraÃ§Ã£o mais complexa
âŒ MÃºltiplas estratÃ©gias
```

## ğŸ” DecisÃ£o de Arquitetura

### **Use ConfiguraÃ§Ã£o Direta quando:**
- Desenvolvimento local
- AplicaÃ§Ãµes simples
- Performance Ã© crÃ­tica
- Controle total necessÃ¡rio

### **Use OTLP Pura quando:**
- ProduÃ§Ã£o enterprise
- MÃºltiplos destinos
- Processamento centralizado
- Ambientes cloud-native

### **Use HÃ­brida quando:**
- Flexibilidade mÃ¡xima necessÃ¡ria
- Diferentes ambientes
- MigraÃ§Ã£o gradual
- Casos de uso diversos

A arquitetura hÃ­brida atual do Package.Observability oferece **o melhor dos dois mundos**, permitindo que vocÃª escolha a estratÃ©gia mais adequada para cada cenÃ¡rio especÃ­fico.
